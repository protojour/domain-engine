(struct ($c)
    (prop $c rel@1:0:0
        (matrix (.. @e $a #u))
    )
    (prop $c rel@1:0:1
        (matrix (.. @f $b #u))
    )
)

(matrix (.. @g
    (match-struct ($d)
        (prop $d rel@2:0:0 element-in
            (matrix
                (.. @e
                    (struct ($q)
                        (prop $q rel@3:0:0 $a)
                    )
                )
                (.. @f
                    (struct ($r)
                        (prop $r rel@3:0:1 $b)
                    )
                )
            )
        )
    )
))

|$c| (block
    (let-prop-default [$e $s] ($c rel@1:0:0) (make-seq) (make-seq))
    (let-prop-default [$f $t] ($c rel@1:0:1) (make-seq) (make-seq))
    (match-struct ($u)
        (let-cond-var $d $u)
        (push-cond-clauses $u
            (root '$d)
        )
        (let-cond-var $v $u)
        (push-cond-clauses $u
            (match-prop '$d rel@2:0:0 element-in '$v)
        )
        (for-each $e $s ($a $_)
            (let-cond-var $q $u)
            (push-cond-clauses $u
                (member '$v (_ '$q))
            )
            (let-cond-var $w $u)
            (push-cond-clauses $u
                (match-prop '$q rel@3:0:0 element-in '$w)
                (member '$w (_ $a))
            )
        )
        (for-each $f $t ($b $_)
            (let-cond-var $r $u)
            (push-cond-clauses $u
                (member '$v (_ '$r))
            )
            (let-cond-var $x $u)
            (push-cond-clauses $u
                (match-prop '$r rel@3:0:1 element-in '$x)
                (member '$x (_ $b))
            )
        )
    )
)
